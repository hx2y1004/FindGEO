<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>   
<script th:inline="javascript">
	function readImage(input) {
		if(input.files && input.files[0]) {
			// FileReader 인스턴스 생성
			const reader = new FileReader();
			// 이미지가 로드가 된 경우
			reader.onload = e => {
				const previewImage = document.getElementById("preview-image");
				previewImage.src = e.target.result;
			}
			// reader가 이미지 읽도록 하기
			reader.readAsDataURL(input.files[0])
		}
	}
	// input file에 change 이벤트 부여
	// const inputImage = document.getElementById("input-image");
	//inputImage.addEventListener("change", e => {
	//     readImage(e.target)
	//})   
	
	function validateForm(form){
		if (form.nickname.value == ""){
			alert("닉네임을 입력하세요.");
			return false;
		}
		if (form.password.value == ""){
			alert("비밀번호를 입력하세요.");
			return false;
		}
		if (form.password2.value == ""){
			alert("비밀번호 체크를 해주세요.");
			return false;
		}
		if (form.phone.value == ""){
			alert("전화번호를 입력하세요.");
			return false;
		}
		var reg = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
		var password = form.password.value;
		console.log(password);
	   	if( !reg.test(password)){
	   	 	alert("비밀번호는 8자 이상, 하나 이상의 문자, 숫자와 하나의 상의 특수문자를 입력해주세요.");
	   	 	return false; 
	   	}
	}
</script>
<body>
<h2>회원정보수정</h2>
<form action="/members/update3" method="post" name="updateForm" enctype="multipart/form-data" th:onsubmit="return validateForm(this);">
	<div>
		<img style="width: 100px;" id="preview-image" th:src="@{ ${name.picture} }" />
		<input type="hidden" name="picture" th:value=${name.picture}/>
		<input style="display: block;" type="file" id="picture" name="file" onchange="readImage(this)" accept="images/png, images/jpg, images/jpeg">
	</div>
	<div>
		<label th:for="email">이메일</label>
		<input type="email" th:value="${name.email}" name="email" id="email" readonly style="background: lightgray;">
	</div>
	<div>
		<label th:for="nickname">닉네임</label>
		<input type="text" id="nickname" th:value="${name.nickname}" name="nickname" paceholder="닉네임을 입력해주세요"><br>
	</div>
	<div>
		<label th:for="password">비밀번호</label>
		<input type="password" id="password_1" name="password" placeholder="비밀번호를 입력해주세요"><br>
	</div>
	<div>
		<label th:for="password2">비밀번호 확인</label>
		<input type="password" placeholder="비밀번호를 다시 입력해주세요" id="password_2" name="password2">
    	<div style="display: inline-block"><font id = "checkPw" size = "2" /></div><br/>
		<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
	</div>
	<div>
		<label th:for="phone">전화번호</label>
		<input type="text" th:value="${name.phone}" name="phone" id="phone" placeholder="전화번호를 입력해주세요"><br>
	</div>
	<input type="hidden" th:value="${name.role}" name="role" id="role" ><br>
	<button type="submit">수정하기</button>
</form>
<script>
	$('#password_2').keyup(function(){
		let pass1 = document.getElementById('password_1').value;
		let pass2 = document.getElementById('password_2').value;
            
		if (pass1 != "" && pass2 != ""){
			if (pass1 == pass2){
				$("#checkPw").html('비밀번호가 일치합니다');
				$("#checkPw").attr('color','#2fb380');
				$("#password_2").addClass("is-valid");
				$("#password_2").removeClass("is-invalid");
				$("#btnConfirm").prop("disabled",false);
			} else {
				$("#checkPw").html('비밀번호가 일치하지 않습니다');
				$("#checkPw").attr('color','#dc3545');
				$("#password_2").removeClass("is-valid");                  
				$("#password_2").addClass("is-invalid");
				$("#btnConfirm").prop("disabled",true);
			}
		}else if (pass1 != "" && pass2 == ""){
			$("#checkPw").html('');
			$("#checkPw").attr('color','whie');
			$("#password_2").addClass("is-valid");
			$("#password_2").removeClass("is-invalid");
			$("#btnConfirm").prop("disabled",false);
		}
	});      
	$('#password_1').keyup(function(){
		let pass1 = document.getElementById('password_1').value;
		let pass2 = document.getElementById('password_2').value;
        
		if (pass1 != "" && pass2 != ""){
			if (pass1 == pass2){
				$("#checkPw").html('비밀번호가 일치합니다');
				$("#checkPw").attr('color','#2fb380');
				$("#password_2").addClass("is-valid");
				$("#password_2").removeClass("is-invalid");
				$("#btnConfirm").prop("disabled",false);
			} else {
				$("#checkPw").html('비밀번호가 일치하지 않습니다');
				$("#checkPw").attr('color','#dc3545');
				$("#password_2").removeClass("is-valid");                  
				$("#password_2").addClass("is-invalid");
				$("#btnConfirm").prop("disabled",true);
			}
		}
	});
	</script>
</body>

   <!-- <script th:inline="javascript">
      const update = () => {
         const pw = [[${name.password}]];
         const confirmPw = document.getElementById("password").value;
         if(pw == confirmPw){
            updateForm.submit();
         }else{
            alert("비밀번호가 틀립니다.")
         }
      }
   </script> -->
</html>