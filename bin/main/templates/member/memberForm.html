<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout2}">
<meta charset="UTF-8">

<head>
	<title>íšŒì›ê°€ì…</title>
	<script src="https://code.jquery.com/jquery-3.6.1.min.js"
		integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
	<script th:inline="javascript">
		function validateForm(form) {
			if (form.nickname.value == "") {
				alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");
				return false;
			}
			if (form.password.value == "") {
				alert("íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
				return false;
			}
			if (form.password2.value == "") {
				alert("ë¹„ë°€ë²ˆí˜¸ ì²´í¬ë¥¼ í•´ì£¼ì„¸ìš”.");
				return false;
			}
			if (form.phone.value == "") {
				alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
				return false;
			}
			if (form.memberEmail.value == "") {
				alert("ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.");
				return false;
			}
			var reg = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
			var password = form.password.value;
			if (!reg.test(password)) {
				alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒ, í•˜ë‚˜ ì´ìƒì˜ ë¬¸ì, ìˆ«ìì™€ í•˜ë‚˜ì˜ ìƒì˜ íŠ¹ìˆ˜ë¬¸ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
				return false;
			}
			var reg = /^[0-9]{10,11}/;
			var phone = form.phone.value;
			if (!reg.test(phone)) {
				alert("ì „í™”ë²ˆí˜¸ëŠ” 10~11ì ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
				return false;
			}
		}
	</script>
</head>
<th:block layout:fragment="css">
	<style>
		#submit {
			border: 2px solid #04479b;
			width: 100px;
			border-radius: 5px;
			float: right;
		}

		#btnemailCheck {
			border: 2px solid #04479b;
			width: 100px;
			border-radius: 5px;
			margin-right: 30px;
		}

		form {
			border-radius: 5px;
			position: relative;
			left: 30%;
			width: 40%;
			margin-top: 5%;
		}

		.form-control {
			width: 600px;
			height: 30px;
			margin-bottom: 10px;
			border-radius: 5px;
			border: 2px solid #04479b;
			background-color: #d3d3d38a;
		}

		#email-dup-result {
			display: block;
			margin-bottom: 10px;
		}

		#pwcheck {
			margin-bottom: 10px;
		}

		label {
			font-size: 20px;
		}
	</style>
</th:block>

<body>
	<div layout:fragment="content2">
		<form action="/members/new" role="form" method="post" th:object="${memberFormDto}"
			th:onsubmit="return validateForm(this);">
			<h1>ğŸŒŸíšŒì›ê°€ì…ğŸŒŸ</h1>
			<div class="form-group">
				<label th:for="memberEmail">ì´ë©”ì¼ì£¼ì†Œ</label><br />
				<input type="email" th:field="*{email}" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." style="display:inline-block;"
					class="form-control" id="memberEmail">
				<input type="button" id="btnemailCheck" style="display:inline-block;" value="ì¤‘ë³µí™•ì¸" name="emailcheck" />
				<span id="email-dup-result"></span>
				<p th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="fieldError">Incorrect data</p>
			</div>
			<div class="form-group">
				<label th:for="nickname">ë‹‰ë„¤ì„</label>
				<input type="text" th:field="*{nickname}" class="form-control" style="display:block;"
					placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." name="nickname">
				<p th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}" class="fieldError">Incorrect data
				</p>
			</div>
			<div class="form-group">
				<label th:for="password">ë¹„ë°€ë²ˆí˜¸</label>
				<input type="password" th:field="*{password}" class="form-control" style="display:block;"
					placeholder="ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ìë¥¼ í˜¼í•©í•˜ì—¬ 8ì ì´ìƒìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”." id="password_1" name="password">
				<p th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="fieldError">Incorrect data
				</p>
			</div>
			<div class="form-group">
				<label th:for="password2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸<span style="display:inline-block; margin:0;" id="pwcheck">
						<font id="checkPw" size="3"></font>
					</span></label><br />
				<input type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”." class="form-control" style="display:inline-block;"
					id="password_2" name="password2">
			</div>
			<div class="form-group">
				<label th:for="phone">ì „í™”ë²ˆí˜¸</label>
				<input type="text" th:field="*{phone}" class="form-control" style="display:block;"
					placeholder="-ì—†ì´ ìˆ«ìë¡œë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”." name="phone">
				<p th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}" class="fieldError">Incorrect data</p>
			</div>
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
			<div style="text-align: center">
				<button type="submit" class="btn btn-primary" disabled="disabled" id="submit">ê°€ì…í•˜ê¸°</button>
			</div>
		</form>
		<img src="/images/backkey.png" width="50px" height="50px" onclick="window.history.back();"
			style="position: fixed; bottom:20px; right:20px;" id="back">

		<script>
			$('#password_2').keyup(function () {
				let pass1 = document.getElementById('password_1').value;
				let pass2 = document.getElementById('password_2').value;

				if (pass1 != "" && pass2 != "") {
					if (pass1 == pass2) {
						$("#checkPw").html('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.');
						$("#checkPw").attr('color', '#2fb380');
						$("#password_2").addClass("is-valid");
						$("#password_2").removeClass("is-invalid");
						$("#btnConfirm").prop("disabled", false);
					} else {
						$("#checkPw").html('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
						$("#checkPw").attr('color', '#dc3545');
						$("#password_2").removeClass("is-valid");
						$("#password_2").addClass("is-invalid");
						$("#btnConfirm").prop("disabled", true);
					}
				} else if (pass1 != "" && pass2 == "") {
					$("#checkPw").html('');
					$("#checkPw").attr('color', 'white');
					$("#password_2").addClass("is-valid");
					$("#password_2").removeClass("is-invalid");
					$("#btnConfirm").prop("disabled", false);
				}
			});
			$('#password_1').keyup(function () {
				let pass1 = document.getElementById('password_1').value;
				let pass2 = document.getElementById('password_2').value;

				if (pass1 != "" && pass2 != "") {
					if (pass1 == pass2) {
						$("#checkPw").html('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤');
						$("#checkPw").attr('color', '#2fb380');
						$("#password_2").addClass("is-valid");
						$("#password_2").removeClass("is-invalid");
						$("#btnConfirm").prop("disabled", false);
					} else {
						$("#checkPw").html('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
						$("#checkPw").attr('color', '#dc3545');
						$("#password_2").removeClass("is-valid");
						$("#password_2").addClass("is-invalid");
						$("#btnConfirm").prop("disabled", true);
					}
				}
			});

			$(document).ready(function () {
				$("#btnemailCheck").on("click", function (event) {
					const email = document.getElementById("memberEmail").value;
					const checkResult = document.getElementById("email-dup-result");
					const target = document.getElementById("submit");
					var reg_email = /^([0-9a-zA-Z_\.-]+)@([0-9a-zA-Z_-]+)(\.[0-9a-zA-Z_-]+){1,2}$/;
					$.ajax({
						type: "get",
						url: "/members/emailCheck",
						dataType: "text",
						data: {
							"memberEmail": email
						},
						success: function (result) {
							if (!reg_email.test(email)) {
								checkResult.innerHTML = "ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.";
								checkResult.style.color = "#dc3545";
								checkResult.style.display = "inline-block";
								checkResult.style.margin = "0";
							} else {
								if (result === 'ok') {
									checkResult.innerHTML = "ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.";
									checkResult.style.color = "#2fb380";
									checkResult.style.display = "inline-block";
									checkResult.style.margin = "0";
									target.disabled = false;
								} else {
									checkResult.innerHTML = "ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì´ë©”ì¼ ì…ë‹ˆë‹¤.";
									checkResult.style.color = "#dc3545";
									checkResult.style.display = "inline-block";
									checkResult.style.margin = "0";
									target.disabled = true;
								}
							}
						},
						error: function () {
							alert("ajax ì‹¤íŒ¨");
						}
					});
				});
			});
		</script>
	</div>
</body>

</html>