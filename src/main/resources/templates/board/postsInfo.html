<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout1}">

<head>
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
<meta id="_csrf_header" name="_csrf_header"
	th:content="${_csrf.headerName}" />
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-3.6.1.js"></script>
<script th:inline="javascript" th:src="@{/js/board.js}"></script>
<script th:inline="javascript">
	/*<![CDATA[*/
	const comment = /*[[${comment}]]*/
	console.log(comment);
	/*]]>*/

	$(document).ready(function() {
		var boardid = $('#boardid').val();
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
		var email = $("#login_email").val();
		var c_email = email.split('@');
		$.ajax({
			beforeSend : function(xhr) {
				xhr.setRequestHeader(header, token);
			},
			dataType : 'json',
			url : '/comments/' + boardid
		}).done(function(data) {
			console.log(data);
			if (data.length === 0) {
				var html = "<table border = '1'>";
				html += "<tr>";
				html += "<p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
				html += "</tr>";
				html += "</table>";
				$("#comments").empty();
				$("#comments").append(html);
			} else {
				var html = "<table>";
				html += "<tr>";
				html += "<th></th>";
				html += "<th></th>";
				html += "<th></th>";
				html += "<th></th>";
				html += "</table>";

				$.each(data, function(key, value) {
					html += "<div style='display: none;'><p id='ch_cmt_cid'>" + value.commentid + "</p></div>";
					html += "<span id='login_name'>" + value.nickname + "</span>";
					html += "<span style='display:inline-block;' id='login_email'>" + "(" + value.email.split('@')[0]+ "@*******" + ")" + "</span>"
					html += "<p id='cmt_content'>" + "\u00A0" + "ğŸ’¬" + value.content + "</p>";
					html += "<button id='c_btn' onClick='deletecomment("+value.commentid+")'>â</button>";
					html += "<div id='commentFromP"+ value.commentid+"'></div>";
				});
				$("#comments").empty();
				$("#comments").append(html);
			}

		}).fail(function(e) {
			alert("ë¶ˆëŸ¬ì˜¤ê¸° ì—ëŸ¬");
		})
	});
</script>
<title>ê²Œì‹œë¬¼ ìƒì„¸ë³´ê¸°</title>
</head>
<th:block layout:fragment="css">
	<style>
#boardid {
	border-style: none;
}

#posting {
	width:50%;
	margin:auto;
}

#content {
	border-style: none;
	width: max-content;
	height: 30%;
	border-radius: 5px;
	font-size: 20px;
	max-width: 600px;
	white-space: pre-wrap;
	word-wrap: break-word;
}

#list, #edit, #btn-delete,#card-footer {
	border: 2px solid #4caf50;
	border-radius: 5px;
	float: right;
	color: black;
	background-color: #f0f0f0;
	text-decoration: none;
	margin: 3px;
	font-size: 17px;
	padding: 2px;
	width: 100px;
	height: 30px;
	text-align: center;
}

label {
	margin-bottom: -5px;
	margin-top: 5px;
}

#author {
	background-color: lightgray;
	font-size: 13px;
	font-weight: bold;
	border: none;
}

.author {
	font-size: 14px;
}

#title {
	margin-bottom: 5px;
	font-size: 25px;
}

.title {
	font-size: 17px;
}

.num, #boardid {
	color: gray;
	font-size: 16px;
	margin-top: 20px;
}
#login_name{
font-weight: bold;
color:hotpink;
font-size: 20px;
margin: 5px;

}

#c_btn{
border: none;
border-radius: 5px;
background-color: transparent;
float : right;
}
#card-footer{
border: 1px solid #607d8b;
border-radius: 5px;
width: 100px;
}

#login_email{
font-size: 13px;
margin-top: 30px;
font-size: 15px;
}
#c_btn{
margin-bottom: 20px;
}
#c_btn:focus{
outline: none;
}
#cmt_content{
margin-left: 15px;
font-size: 16px;
}

#comments{
background-color: #fafafa;
}



</style>
</th:block>

<body>
   <div layout:fragment="content">
      <div id="posting">
         <form>
            <div class="num">
               <label>ê¸€ë²ˆí˜¸</label> <input type="text" id="boardid" name="boardid"
                  th:value="${posts.boardid}" readonly> <label>ì‘ì„±ì¼ </label>
               <span th:text="${#temporals.format(posts.regdate,'yyyy-MM-dd')}"></span>
               <label>ì¡°íšŒìˆ˜</label> <span th:text="${posts.views}"></span>
            </div>
            <hr>
            <div>
               <label class="author">ì‘ì„±ì</label> <input type="text" id="author"
                  th:value="|${posts.nickname} (${sub_Email} ) |" readonly>
            </div>
            <label class="title" for="title" style="display: block;">ì œëª©</label>
            <p id="title">[[${posts.boardtitle}]]</p>
            <hr>
            <div>
               <label for="content" style="display: block;"></label>
               <p id="content">[[${posts.boardcontent}]]</p>
            </div>
            <hr>
         </form>
         <span sec:authorize="isAuthenticated()"> <span
            th:if="${check}"> <a href="#" id="btn-delete"
               onclick="postDelete()">ì‚­ì œ</a> <a id="edit"
               th:href="@{/post/update/{boardid}(boardid = ${posts.boardid})}">ìˆ˜ì •</a>
         </span>
         </span> <a id="list" href="/board/boardlist">ëª©ë¡</a> <br /> <br />
         <div class="card">
            <input type="hidden" name="login_name" id="login_name"
               th:value="${member.nickname}" /> <input type="hidden"
               name="login_email" id="login_email" th:value="${member.email}" />
            <div class="card-body">
               <textarea class="form-control" id="cmt_content" rows="1"></textarea>
            </div>
            <div class="card-footer">
               <button id="card-footer" onClick="commentSave()">ë“±ë¡</button>
            </div>
         </div>
         <br />
         <div class="card">
            <ul id="comment--box" class="list-group">
               <li id="comment--1"
                  class="list-goup-item d-flex justify-content-between">
               </li>
            </ul>
                  <div id="comments">ëŒ“ê¸€</div>
         </div>
         <br /> <br />
      </div>
   </div>
</body>

</html>




