<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<head>

<title>회원가입</title>
</head>
<body>

    <form action="/members/new" role="form"  method="post"  th:object="${memberFormDto}">
        <div class="form-group">
            <label th:for="nickname">닉네임</label>
            <input type="text" th:field="*{nickname}" class="form-control" placeholder="닉네임을 입력해주세요">
            <p th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}" class="fieldError">Incorrect data</p>
        </div>
        <div class="form-group">
            <label th:for="password">비밀번호</label>
            <input type="password" th:field="*{password}" class="form-control" placeholder="비밀번호를 입력해주세요" id="password_1">
            <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="fieldError">Incorrect data</p>
        </div>
        <div class="form-group">
            <label th:for="password">비밀번호 확인</label>
            <input type="password" placeholder="비밀번호를 입력해주세요" id="password_2">
            <div style="display: inline-block"><font id = "checkPw" size = "2"></font></div>

        </div>
        <div class="form-group">
            <label th:for="phone">휴대폰번호</label>
            <input type="text" th:field="*{phone}" class="form-control" placeholder="휴대폰 번호를 입력해주세요(-제외)">
            <p th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}" class="fieldError">Incorrect data</p>

        </div>
        <div class="form-group">
            <label th:for="email">이메일주소</label>
            <input type="email" th:field="*{email}" class="form-control" placeholder="이메일을 입력해주세요" name="memberEmail" id="memberEmail" >
               <input type="button" id="btnemailCheck" value="email 중복체크"/>
            <span id="email-dup-result"></span>
            <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="fieldError">Incorrect data</p>
        </div>
        	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <div style="text-align: center">
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
    </form>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>   
	<script>
   
      $('#password_2').keyup(function(){
          let pass1 = document.getElementById('password_1').value;
          let pass2 = document.getElementById('password_2').value;
            
          if (pass1 != "" || pass2 != ""){
             if (pass1 == pass2){
                 $("#checkPw").html('비밀번호가 일치합니다');
                 $("#checkPw").attr('color','#2fb380');
                 $("#password_2").addClass("is-valid");
                 $("#password_2").removeClass("is-invalid");
                 $("#btnConfirm").prop("disabled",false);
              } else {
                 $("#checkPw").html('비밀번호가 일치하지 않습니다');
                     $("#checkPw").attr('color','#dc3545');
                 $("#password_2").removeClass("is-valid");                  
                 $("#password_2").addClass("is-invalid");
                 $("#btnConfirm").prop("disabled",true);
              }
          }
      });      
     
     $(document).ready(function (){
            $("#btnemailCheck").on("click", function(event){
               const email = document.getElementById("memberEmail").value;
                const checkResult = document.getElementById("email-dup-result");
  
               $.ajax({
                  
                type: "get",
                url: "/members/emailCheck",
                dataType: "text",
                data:{
                   "memberEmail":email
                },
                success:function(result){
                   if(result === 'ok'){
                      checkResult.innerHTML ="사용가능합니다.";
                      checkResult.style.color = "green";
                }else{
					
                   checkResult.innerHTML ="이미 사용중인 이메일 입니다.";
                  checkResult.style.color = "red";
                   }
                },
                error: function(){
                   
                   alert("ajax 실패");
                }
               });
            });
         });
	</script>
</body>
</html>